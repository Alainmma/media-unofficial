# Copyright 2009 Ali Polatel <alip@exherbo.org>
# Distributed under the terms of the GNU General Public License v2

require github [ user=quodlibet tag=release-${PV} ]
require setup-py [ import=distutils work=${PN}-release-${PV} test=pytest ]

SUMMARY="Python module to handle audio metadata"
DESCRIPTION="
Mutagen supports ASF, FLAC, M4A, Monkey's Audio, MP3, Musepack, Ogg FLAC, Ogg
Speex, Ogg Theora, Ogg Vorbis, True Audio, WavPack and OptimFROG audio files.
All versions of ID3v2 are supported, and all standard ID3v2.4 frames are parsed.
It can read Xing headers to accurately calculate the bitrate and length of MP3s.
ID3 and APEv2 tags can be edited regardless of audio format. It can also
manipulate Ogg streams on an individual packet/page level.
"

BUGS_TO="alip@exherbo.org"
REMOTE_IDS+=" pypi:${PN}"

UPSTREAM_CHANGELOG="https://${PN}.readthedocs.io/en/latest/changelog.html"
UPSTREAM_DOCUMENTATION="https://${PN}.readthedocs.io"

LICENCES="GPL-2"
SLOT="0"
MYOPTIONS=""

DEPENDENCIES="
    test:
        media-libs/faad2
        media-libs/flac[ogg]
        media-sound/vorbis-tools
"

prepare_one_multibuild() {
    setup-py_prepare_one_multibuild

    # The ez_setup.py generated by setup-py.exlib does not fit in the scheme
    # expected by this test.
    edo sed -e "s:\(if filename.endswith('.py')\):\1 and filename != \"ez_setup.py\":" \
            -i tests/test_encoding.py
}

setup-py_test_one_multibuild() {
    export LC_ALL="en_US.UTF-8"
    edo ${PYTHON} -B setup.py test
}

