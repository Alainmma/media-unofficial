# Copyright 2009 Sterling X. Winter <sterling.winter@gmail.com>
# Distributed under the terms of the GNU General Public License v2
# Based in part upon 'gst-python-0.10.13.ebuild' from Gentoo, which is:
#     Copyright 1999-2008 Gentoo Foundation

NEED_PYTHON=2.4:=

require multilib python

SUMMARY="GStreamer Python bindings"
HOMEPAGE="http://gstreamer.freedesktop.org/"
DOWNLOADS="http://gstreamer.freedesktop.org/src/${PN}/${PNV}.tar.bz2"

LICENCES="LGPL-2"
SLOT="0.10"
PLATFORMS="~amd64 ~x86"
MYOPTIONS="examples"

DEPENDENCIES="
    build+run:
          dev-libs/libxml2
        >=media-libs/gstreamer-0.10.21
        >=media-plugins/gst-plugins-base-0.10.21
        || (
               >=gnome-bindings/pygobject-2.11.2
               >=gnome-bindings/pygtk-2.6.3
           )
"

src_unpack() {
    unpack ${ARCHIVES}
    cd "${WORK}"

    # Let python_mod_optimize handle byte compiling in pkg_postinst()
    rm -f py-compile || die "rm -f py-compile failed"
    ln -s $(type -P true) py-compile || die "ln -s \$(type -P true) py-compile failed"
}

DEFAULT_SRC_PREPARE_PATCHES=( "${FILES}"/gst-python-0.10.9-lazy.patch )

src_install() {
    default

    if option examples ; then
        docinto examples
        dodoc examples/*
    fi
}

pkg_postinst() {
    python_version
    python_mod_optimize $(python_get_sitedir)
}

pkg_postrm() {
    python_version
    python_mod_cleanup
}
