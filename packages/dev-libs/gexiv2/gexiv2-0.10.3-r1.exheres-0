# Copyright 2010-2015 Pierre Lejeune <superheron@gmail.com>
# Distributed under the terms of the GNU General Public License v2

require python

SUMMARY="GObject wrapper for Exiv2"
DESCRIPTION="
gexiv2 is a GObject-based wrapper around the Exiv2 library. It makes the basic features of Exiv2
available to GNOME applications.
"
HOMEPAGE="http://redmine.yorba.org/projects/${PN}/wiki"
DOWNLOADS="mirror://gnome/sources/${PN}/$(ever range 1-2)/${PNV}.tar.xz"

LICENCES="GPL-2"
SLOT="0"
PLATFORMS="~amd64"
MYOPTIONS="gobject-introspection"

DEPENDENCIES="
    build:
        gobject-introspection? ( gnome-desktop/gobject-introspection:1 )
    build+run:
        dev-libs/glib:2[>=2.26.1]
        graphics/exiv2[>=0.21]
        gobject-introspection? (
            dev-lang/python:=[~>2.0] [[ note = [ fix this better when we have multipy ] ]]
        )
    test+run:
        dev-lang/vala:*
"

DEFAULT_SRC_CONFIGURE_OPTION_ENABLES=( 'gobject-introspection introspection' )
DEFAULT_SRC_CONFIGURE_TESTS=( "--enable-tests --disable-tests" )
DEFAULT_SRC_INSTALL_PARAMS=( "LIB=${LIBDIR}" )

src_prepare() {
    default
    # https://bugzilla.gnome.org/show_bug.cgi?id=751615
    # Sed'ing to avoid requiring autotools
    edo sed -e 's/pkg-config/\$\(PKG_CONFIG\)/' -i Makefile.in
}

src_test() {
    emake tests
}

src_install() {
    default
    option gobject-introspection && python_bytecompile
}

