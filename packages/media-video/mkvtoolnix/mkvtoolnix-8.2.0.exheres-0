# Copyright 2009, 2010 Michael Forney
# Distributed under the terms of the GNU General Public License v2

require autotools [ supported_autoconf=[ 2.5 ] supported_automake=[ none ] ]

SUMMARY="MKVToolnix is a set of tools to create, alter and inspect Matroska files under Linux"
HOMEPAGE="https://www.bunkus.org/videotools/${PN}"
DOWNLOADS="${HOMEPAGE}/sources/${PNV}.tar.xz"

REMOTE_IDS="freecode:${PN}"

BUGS_TO="michael@obberon.com"

LICENCES="GPL-2"
SLOT="0"
PLATFORMS="~amd64 ~x86"
MYOPTIONS="
    flac
    qt5
    wxwidgets
"

# automagic pandoc dependency for generating developer manual
# TODO: use drake instead of rake to allow parallel building
DEPENDENCIES="
    build:
        dev-lang/ruby:*[>=2.0.0]
        sys-devel/gettext
        sys-devel/gcc:*[>=4.6]
        virtual/pkg-config[>=0.9.0]
    build+run:
        dev-libs/boost[>=1.47.0]
        media-libs/libebml[>=1.3.1]
        media-libs/libmatroska[>=1.4.2]
        media-libs/libogg
        media-libs/libvorbis
        sys-apps/file
        sys-libs/zlib
        flac? ( media-libs/flac )
        qt5? ( x11-libs/qtbase:5[>=5.0.0] )
        wxwidgets? ( x11-libs/wxGTK:3.0 )
"

DEFAULT_SRC_PREPARE_PATCHES=( "${FILES}"/0001-GUI-use-correct-variable-name.patch )

DEFAULT_SRC_CONFIGURE_OPTION_ENABLES=( 'qt5 qt' 'wxwidgets' )
DEFAULT_SRC_CONFIGURE_OPTION_WITHS=( flac )
DEFAULT_SRC_CONFIGURE_PARAMS=(
    --disable-static
    --with-gettext
    --without-curl
)

src_prepare() {
    default

    edo sed -i -e "s:strings:/usr/$(exhost --target)/bin/$(exhost --tool-prefix)strings:g" ac/endianess.m4

    eautoconf
}

src_compile() {
    edo rake
}

src_install() {
    edo rake DESTDIR="${IMAGE}" install
}

